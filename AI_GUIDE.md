# Guide for AI Agents

- Runtime: use .NET 9 and the local SDK at `/home/asd/.dotnet/dotnet` for `run`, `test`, `build`.
- Architecture:
  - Core: only domain contracts/entities, no framework refs.
  - Application: document parsing/indexing/search + bot update handling; keep it Telegram-agnostic.
  - Api: composition root (DI, hosting), controllers (`/api/simulation`), concrete `IBotResponseSender` for web simulation.
- Conversation flow:
  - `/start` outputs the node with `Id=start` from `Scenario:FilePath` (help/usage).
  - Callback data is treated as a node id (scenario buttons).
  - Plain text is treated as a search query over `.docx` documents (`Documents:RootPath`) and returns matches grouped by folder hierarchy.
  - `/reindex` (and `/reload`) rebuilds the documents index (admin-only via `Admin:AllowedUserIds`) and also reloads scenario JSON.
- Documents:
  - Supported format: `.docx` (OpenXML). `.doc` must be converted to `.docx`.
  - Index is in-memory (`DocumentSearchService`), built lazily on first search or via `/reindex`.
  - Extraction is done via `ZipArchive` + streaming XML parse (no external Word libs).
- Configuration:
  - Admins: `Admin:AllowedUserIds`.
  - Scenario: `Scenario:FilePath` (defaults to `data/scenario.json`).
  - Documents: `Documents:RootPath` (defaults to `data/docs`), plus tuning options (`MinQueryLength`, `MaxResults`, etc.).
- Testing:
  - Keep unit tests under `RevitHelperBot.Application.Tests`; prefer fakes for repositories/extractors.
  - Run with `/home/asd/.dotnet/dotnet test RevitHelperBot.sln`.
- Containerization: Dockerfile lives in `RevitHelperBot.Api`; compose mounts `./data` to `/app/data` (place docs under `./data/docs`).
- Performance: use `RevitHelperBot.Perf` to generate synthetic `.docx`, build index and benchmark search latency/memory.
